# Eat-Fit - сервис доставки здоровой еды

**Содержание**
1. [Предметная область](#предметная-область)
2. [Схема БД](#схема-бд)
    - [Описание таблиц](#описание-таблиц)
    - [Индексы](#индексы)
    - [Aвтоматические проверки (Check Constraints)](#автоматические-проверки-check-constraints)


## Предметная область
Сервис доставки здоровой еды через мобильное приложение.

**Целевая аудитория**: люди в возрасте от 20 до 50 лет, следящие за своим питанием и желающие разнообразить свой рацион, не выходя за рамки диеты.

## Схема БД

БД ориентирована на оформление заказов из мобильного приложения, где клиенты могут отслеживать статус заказа и ориентировочное время доставки.

По каждому выполненному заказу клиенту предлагается оценить заказ и работу курьера.
На основе этих данных курьерам выставляется средний рейтинг и дорабатывается рецептура блюд.


![image](https://user-images.githubusercontent.com/19695435/146063239-a5b7d894-b27c-42bd-8abd-8ab9be3d4ba7.png)


### Описание таблиц

- **Customer** - таблица с данными о клиентах
- **Address** - таблица с адресами доставки заказов. Также используется для хранения адресов клиентов по-умолчанию
- **Order** - таблица с данными о заказах
- **Feedback** - таблица с отзывами пользователей о заказах. Используется для формирования рейтинга курьеров
- **Payment** - таблица с данными об оплате заказа
- **Basket** - таблица с итоговыми данными о корзине заказа, содержит информацию об итоговой сумме заказа и итоговой сумме скидок
- **BasketList** - таблица с данными о составе корзины заказа, содержит информацию о количестве блюд и цене блюда на момент заказа
- **Promocode** - таблица с данными о промокодах, содержит информацию о размере скидки (в процентах, вещественное число от 0 до 1), правилах применения (в виде json), датах действия, а также флаг включен/выключен
- **AppliedPromocode** - таблица с данными о промокодах, примененных к заказам
- **Meal** - таблица с данными о блюдах. Здесь хранится описание, размер порции, состав, КБЖУ, а также цена блюда
- **OrderQueue** - таблица-очередь заказов. Здесь хранится статус заказа, ожидаемое время доставки, а также назначенный на заказ курьер
- **Courier** - таблица с курьерами. У каждого курьера есть средний рейтинг, который складывается из рейтинга всех доставленных заказов


### Индексы

- **UQ_Customer_Phone** - уникальный индекс для таблицы Customer по полю Phone, необходим для быстрого поиска клиента по номеру телефона, проверяет чтобы номера телефонов не повторялись
- **UQ_Courier_Phone** - уникальный индекс для таблицы Courier по полю Phone, необходим для быстрого поиска курьера по номеру телефона в таблице, проверяет чтобы номера телефонов не повторялись. Индекс включает в себя поля FirstName и RatingAvg для быстрого отображения имени рейтинга курьера в приложении
- **IX_Order_CustomerId_CreatedAt** - композитный индекс для таблицы Order по полям CustomerId и CreatedAt, используется в запросах для сбора статистики заказов по клиенту. Индекс включает в себя поле TotalPrice для подсчета общей суммы заказов по клиенту за конкретный период времени
- **IX_Meal_Name** - индекс для таблицы Meal по полю Name, используется в полнотекстовом поиске по названию блюда из мобильного приложения
- **IX_Promocode_Code** - индекс для таблицы Promocode по полю Code, используется в полнотекстовом поиске по промокоду при оформлении заказа

Также индексы будут автоматически сгенерированы для всех внешних ключей, что должно покрыть остальную часть возможных запросов к БД.

### Автоматические проверки (Check Constraints)

- **CK_Basket_TotalDiscount_Between_0_And_1** - проверка для таблицы Basket,  
поле TotalDiscount должно принадлежать диапазону \[0; 1\] (процент скидки)
- **CK_Basket_TotalPrice_NonNegative** - проверка для таблицы Basket,  
поле TotalPrice должно быть неотрицательным числом (>= 0)
- **CK_BasketList_PositionPrice_NonNegative** - проверка для таблицы BasketList,  
поле PositionPrice должно быть неотрицательным числом (>= 0)
- **CK_BasketList_Quantity_NonNegative** - проверка для таблицы BasketList,  
поле Quantity должно быть неотрицательным числом (>= 0)
- **CK_Feedback_CourierRating_NonNegative** - проверка для таблицы Feedback,  
поле CourierRating должно быть неотрицательным числом (>= 0)
- **CK_Feedback_OrderRating_NonNegative** - проверка для таблицы Feedback,  
поле OrderRating должно быть неотрицательным числом (>= 0)
- **CK_Meal_Calories_NonNegative** - проверка для таблицы Meal,  
поле Calories должно быть неотрицательным числом (>= 0)
- **CK_Meal_Carbs_NonNegative** - проверка для таблицы Meal,  
поле Carbs должно быть неотрицательным числом (>= 0)
- **CK_Meal_Fats_NonNegative** - проверка для таблицы Meal,  
поле Fats должно быть неотрицательным числом (>= 0)
- **CK_Meal_Price_NonNegative** - проверка для таблицы Meal,  
поле Price должно быть неотрицательным числом (>= 0)
- **CK_Meal_Protein_NonNegative** - проверка для таблицы Meal,  
поле Protein должно быть неотрицательным числом (>= 0)
- **CK_Promocode_Discount_Between_0_And_1** - проверка для таблицы Promocode,  
поле Discount должно принадлежать диапазону \[0; 1\] (процент скидки)
